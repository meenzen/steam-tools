@using Meenzen.SteamTools.Services
@inject SteamApi Api

@if (!Api.IsConfigured)
{
    <MudContainer MaxWidth="MaxWidth.ExtraSmall">
        <MudAlert Severity="Severity.Success">Please provide your SteamID and API key. This allows the app to load data from the Steam API.</MudAlert>
        <MudForm FieldChanged="@Validate">
            <MudAlert Severity="Severity.Info" Class="mt-4">
                Disclaimer: All data is stored in memory and will be deleted when you close this website.
                Steam API requests will be proxied through Cloudflare, your credentials are not stored on the server, Cloudflare automatically redacts your API key from the logs.
                If you don't feel comfortable with this, don't use this website.
            </MudAlert>

            <MudNumericField T="ulong?" Label="SteamID" @bind-Value="SteamId" HideSpinButtons="true" Immediate="true"/>

            <MudTextField Label="API Key" @bind-Value="ApiKey" Immediate="true"/>

            <MudAlert Severity="Severity.Info" Class="mt-4">
                You can find your API key <MudLink Typo="Typo.body2" Href="https://steamcommunity.com/dev/apikey" Target="_blank">here</MudLink>.
            </MudAlert>

            <MudButton Variant="Variant.Filled" Color="Color.Primary" FullWidth="true" Class="mt-4" OnClick="@Save" Disabled="@(!IsValid)">Apply</MudButton>
        </MudForm>
    </MudContainer>
}
else
{
    <MudAlert Severity="Severity.Success">API credentials are configured, you can now use the tool.</MudAlert>
}

@code
{
    private ulong? SteamId { get; set; } = null;
    private string ApiKey { get; set; } = string.Empty;
    private bool IsValid { get; set; } = false;

    [Parameter, EditorRequired]
    public EventCallback OnSave { get; set; }

    private void Validate()
    {
        IsValid = SteamId is not null && SteamId != 0 && !string.IsNullOrEmpty(ApiKey);
    }

    private async Task Save()
    {
        Validate();
        if (!IsValid || SteamId is null)
        {
            return;
        }

        Api.ApiKey = ApiKey;
        Api.SteamId = (ulong)SteamId;

        await OnSave.InvokeAsync();
    }
}